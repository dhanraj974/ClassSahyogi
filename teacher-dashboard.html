<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Teacher Dashboard ‚Ä¢ ClassSahyogi</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter&display=swap" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    html { scroll-behavior: smooth; }
    * { box-sizing: border-box; font-family: 'Inter', sans-serif; }
    body { margin: 0; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); min-height: 100vh; overflow-x: hidden; }
    .layout { display: flex; min-height: 100vh; }
    nav { width: 220px; background: #232946; color: #fff; display: flex; flex-direction: column; align-items: center; padding: 32px 0; }
    nav a { color: #fff; text-decoration: none; margin: 18px 0; display: flex; align-items: center; gap: 10px; font-size: 1.1rem; }
    nav a:hover { color: #ffd700; }
    .user-info { background: rgba(255,255,255,0.1); padding: 15px; border-radius: 10px; margin: 20px; text-align: center; }
    .user-info h4 { margin: 0 0 5px 0; color: #ffd700; }
    .user-info p { margin: 0; font-size: 0.9rem; color: #ccc; }
    .logout-btn { background: #e74c3c; color: white; border: none; border-radius: 8px; padding: 8px 16px; cursor: pointer; margin-top: 10px; }
    .logout-btn:hover { background: #c0392b; }
    header { height: 64px; background: rgba(255,255,255,0.95); box-shadow: 0 2px 12px rgba(35,41,70,0.06); display: flex; align-items: center; padding: 0 36px; color: #232946; font-weight: 500; gap: 12px; }
    .card { background: rgba(255,255,255,0.98); border-radius: 18px; box-shadow: 0 8px 32px rgba(35,41,70,0.10); margin: 32px 48px; padding: 36px 48px; min-height: 80vh; flex: 1; }
    .stats-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 16px; margin-bottom: 24px; }
    .stat-card { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 20px; border-radius: 12px; text-align: center; }
    .stat-value { font-size: 2rem; font-weight: bold; margin-bottom: 8px; }
    .quick-actions { display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px; margin: 30px 0; }
    .action-card { background: white; border-radius: 12px; padding: 20px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); text-align: center; cursor: pointer; transition: transform 0.3s ease; }
    .action-card:hover { transform: translateY(-5px); }
    .action-icon { font-size: 2.5rem; margin-bottom: 10px; }
    .action-title { font-size: 1.2rem; font-weight: 600; margin-bottom: 8px; color: #333; }
    .action-desc { color: #666; font-size: 0.9rem; }
    .recent-activity { background: #f8f9fa; border-radius: 12px; padding: 20px; margin-top: 20px; }
    .activity-item { display: flex; align-items: center; gap: 10px; padding: 10px 0; border-bottom: 1px solid #e9ecef; }
    .activity-item:last-child { border-bottom: none; }
    .activity-icon { font-size: 1.2rem; }
    .activity-text { flex: 1; }
    .activity-time { color: #666; font-size: 0.8rem; }
    .restricted-notice { background: #fff3cd; border: 1px solid #ffeaa7; border-radius: 8px; padding: 15px; margin: 20px 0; color: #856404; }
  </style>
</head>
<body>
  <div class="layout">
    <nav>
      <div style="display:flex;flex-direction:column;align-items:center;gap:8px;margin-bottom:40px;">
        <div style="width:180px;height:100px;background:linear-gradient(135deg,#1e3c72 0%,#2a5298 50%,#ff6b6b 100%);border-radius:20px;display:flex;flex-direction:column;align-items:center;justify-content:center;box-shadow:0 8px 25px rgba(30,60,114,0.4);padding:16px;position:relative;overflow:hidden;">
          <div style="position:absolute;top:-10px;right:-10px;width:40px;height:40px;background:rgba(255,255,255,0.1);border-radius:50%;transform:rotate(45deg);"></div>
          <div style="position:absolute;bottom:-15px;left:-15px;width:30px;height:30px;background:rgba(255,255,255,0.08);border-radius:50%;transform:rotate(-30deg);"></div>
          <div style="width:50px;height:50px;background:rgba(255,255,255,0.95);border-radius:12px;display:flex;align-items:center;justify-content:center;margin-bottom:8px;box-shadow:0 4px 15px rgba(0,0,0,0.2);">
            <div style="width:30px;height:30px;background:linear-gradient(45deg,#ff6b6b,#4ecdc4);border-radius:8px;display:flex;align-items:center;justify-content:center;position:relative;">
              <div style="width:20px;height:20px;background:#fff;border-radius:4px;display:flex;align-items:center;justify-content:center;">
                <div style="width:12px;height:12px;background:linear-gradient(45deg,#ff6b6b,#4ecdc4);border-radius:2px;position:relative;">
                  <div style="position:absolute;top:2px;left:2px;width:4px;height:4px;background:#fff;border-radius:1px;"></div>
                  <div style="position:absolute;bottom:2px;right:2px;width:4px;height:4px;background:#fff;border-radius:1px;"></div>
                </div>
              </div>
            </div>
          </div>
          <div style="font-size:1.4rem;font-weight:800;color:#fff;text-align:center;line-height:1.1;letter-spacing:2px;text-shadow:0 2px 4px rgba(0,0,0,0.3);">
            <span style="color:#FFD700;text-shadow:0 0 10px rgba(255,215,0,0.5);">CS</span>
          </div>
          <div style="font-size:0.6rem;color:rgba(255,255,255,0.9);font-weight:500;margin-top:2px;letter-spacing:1px;">
            ClassSahyogi
          </div>
        </div>
      </div>
      
      <div class="user-info">
        <h4 id="userName">Teacher User</h4>
        <p id="userRole">Teacher</p>
        <button class="logout-btn" onclick="logout()">Logout</button>
      </div>

      <a href="javascript:void(0)" onclick="navigateTo('dashboard')"><span>üè†</span> Dashboard</a>
      <a href="javascript:void(0)" onclick="navigateTo('enrollment')"><span>üìù</span> Students</a>
      <a href="javascript:void(0)" onclick="navigateTo('attendance')"><span>üßæ</span> Attendance</a>
      <a href="javascript:void(0)" onclick="navigateTo('marks')"><span>üéì</span> Marks</a>
      <a href="javascript:void(0)" onclick="navigateTo('timetable')"><span>üìÖ</span> Timetable</a>
      <a href="javascript:void(0)" onclick="navigateTo('fees')"><span>üí∞</span> Fees</a>
      <a href="javascript:void(0)" onclick="navigateTo('analytics')"><span>üìä</span> Analytics</a>
    </nav>
    
    <div style="flex:1;display:flex;flex-direction:column;min-height:100vh;">
      <header>
        <div style="width:140px;height:45px;background:linear-gradient(135deg,#1e3c72 0%,#2a5298 50%,#ff6b6b 100%);border-radius:12px;display:flex;align-items:center;justify-content:center;margin-right:12px;padding:8px;position:relative;overflow:hidden;box-shadow:0 4px 15px rgba(30,60,114,0.3);">
          <div style="position:absolute;top:-5px;right:-5px;width:20px;height:20px;background:rgba(255,255,255,0.1);border-radius:50%;transform:rotate(45deg);"></div>
          <div style="width:25px;height:25px;background:rgba(255,255,255,0.95);border-radius:6px;display:flex;align-items:center;justify-content:center;margin-right:8px;box-shadow:0 2px 8px rgba(0,0,0,0.2);">
            <div style="width:15px;height:15px;background:linear-gradient(45deg,#ff6b6b,#4ecdc4);border-radius:4px;position:relative;">
              <div style="position:absolute;top:1px;left:1px;width:2px;height:2px;background:#fff;border-radius:1px;"></div>
              <div style="position:absolute;bottom:1px;right:1px;width:2px;height:2px;background:#fff;border-radius:1px;"></div>
            </div>
          </div>
          <div style="font-size:0.9rem;font-weight:800;color:#fff;letter-spacing:1px;text-shadow:0 1px 3px rgba(0,0,0,0.3);">
            <span style="color:#FFD700;text-shadow:0 0 8px rgba(255,215,0,0.4);">CS</span>
          </div>
        </div>
        <span>üë®‚Äçüè´ Teacher Dashboard - Limited Access</span>
      </header>
      
      <div class="card">
        <h2 style="margin: 0 0 30px 0; color: #333;">Welcome to Teacher Dashboard</h2>
        
        <div class="restricted-notice">
          <strong>‚ö†Ô∏è Access Notice:</strong> As a teacher, you have access to student management, attendance, marks, and other educational features.
        </div>
        
        <!-- Key Statistics -->
        <div class="stats-grid">
          <div class="stat-card">
            <div class="stat-value" id="totalStudents">0</div>
            <div>Total Students</div>
          </div>
          <div class="stat-card">
            <div class="stat-value" id="myClasses">0</div>
            <div>My Classes</div>
          </div>
          <div class="stat-card">
            <div class="stat-value" id="pendingMarks">0</div>
            <div>Pending Marks</div>
          </div>
          <div class="stat-card">
            <div class="stat-value" id="avgAttendance">0%</div>
            <div>Class Attendance</div>
          </div>
        </div>

        <!-- Student Search Section -->
        <div style="background: #f8f9fa; border-radius: 12px; padding: 20px; margin: 20px 0; border: 1px solid #e9ecef;">
          <h3 style="margin: 0 0 15px 0; color: #333; display: flex; align-items: center; gap: 10px;">
            üîç Search Students
          </h3>
          <div style="display: flex; gap: 10px; margin-bottom: 15px; flex-wrap: wrap;">
            <input type="text" id="searchInput" placeholder="Search by name, roll number, or class..." 
                   style="flex: 1; min-width: 250px; padding: 12px; border: 1px solid #ddd; border-radius: 8px; font-size: 14px;">
            <button onclick="searchStudents()" style="background: #667eea; color: white; border: none; padding: 12px 20px; border-radius: 8px; cursor: pointer; font-weight: 600;">
              Search
            </button>
            <button onclick="clearSearch()" style="background: #6c757d; color: white; border: none; padding: 12px 20px; border-radius: 8px; cursor: pointer; font-weight: 600;">
              Clear
            </button>
          </div>
          <div id="searchResults" style="max-height: 300px; overflow-y: auto; border: 1px solid #e9ecef; border-radius: 8px; background: white;">
            <!-- Search results will appear here -->
          </div>
        </div>

        <!-- Quick Actions -->
        <h3 style="margin: 30px 0 20px 0; color: #333;">Quick Actions</h3>
        <div class="quick-actions">
          <div class="action-card" onclick="navigateTo('enrollment')">
            <div class="action-icon">üìù</div>
            <div class="action-title">View Students</div>
            <div class="action-desc">View student information</div>
          </div>
          <div class="action-card" onclick="navigateTo('attendance')">
            <div class="action-icon">üßæ</div>
            <div class="action-title">Mark Attendance</div>
            <div class="action-desc">Take class attendance</div>
          </div>
          <div class="action-card" onclick="navigateTo('marks')">
            <div class="action-icon">üéì</div>
            <div class="action-title">Enter Marks</div>
            <div class="action-desc">Enter student marks</div>
          </div>
          <div class="action-card" onclick="navigateTo('timetable')">
            <div class="action-icon">üìÖ</div>
            <div class="action-title">View Timetable</div>
            <div class="action-desc">Check class schedule</div>
          </div>
          <div class="action-card" onclick="navigateTo('fees')">
            <div class="action-icon">üí∞</div>
            <div class="action-title">View Fees</div>
            <div class="action-desc">Check fee status</div>
          </div>
          <div class="action-card" onclick="navigateTo('analytics')">
            <div class="action-icon">üìä</div>
            <div class="action-title">View Analytics</div>
            <div class="action-desc">Performance reports</div>
          </div>
        </div>

        <!-- Available Features Notice -->
        <div style="background: #f8f9fa; border-radius: 12px; padding: 20px; margin-top: 20px; border-left: 4px solid #28a745;">
          <h4 style="margin: 0 0 10px 0; color: #155724;">‚úÖ Available Features</h4>
          <ul style="margin: 0; color: #666;">
            <li>View and manage student information</li>
            <li>Mark and track student attendance</li>
            <li>Enter and manage student marks</li>
            <li>View class timetables</li>
            <li>Access student analytics and reports</li>
          </ul>
        </div>

        <!-- Recent Activity -->
        <div class="recent-activity">
          <h3 style="margin: 0 0 20px 0; color: #333;">Recent Activity</h3>
          <div id="recentActivityList">
            <div class="activity-item">
              <div class="activity-icon">üßæ</div>
              <div class="activity-text">Marked attendance for Class 10A</div>
              <div class="activity-time">1 hour ago</div>
            </div>
            <div class="activity-item">
              <div class="activity-icon">üéì</div>
              <div class="activity-text">Entered marks for Mathematics</div>
              <div class="activity-time">3 hours ago</div>
            </div>
            <div class="activity-item">
              <div class="activity-icon">üìä</div>
              <div class="activity-text">Viewed class performance report</div>
              <div class="activity-time">1 day ago</div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <script src="common.js"></script>
  <script>
    // Check authentication
    window.addEventListener('load', () => {
      const currentUser = sessionStorage.getItem('currentUser');
      if (!currentUser) {
        window.location.href = 'login.html';
        return;
      }
      
      const user = JSON.parse(currentUser);
      if (user.role !== 'teacher') {
        window.location.href = 'login.html';
        return;
      }
      
      document.getElementById('userName').textContent = user.name;
      document.getElementById('userRole').textContent = 'Teacher';
      loadDashboardData();
    });

    function loadDashboardData() {
      // Load students data
      const students = JSON.parse(localStorage.getItem('students')) || [];
      document.getElementById('totalStudents').textContent = students.length;

      // Mock data for teacher-specific stats
      document.getElementById('myClasses').textContent = '3'; // Mock: 3 classes assigned
      document.getElementById('pendingMarks').textContent = '12'; // Mock: 12 pending marks

      // Load attendance data
      const attendance = JSON.parse(localStorage.getItem('attendance')) || {};
      let totalAttendance = 0;
      let totalRecords = 0;
      Object.values(attendance).forEach(division => {
        Object.values(division).forEach(dayRecords => {
          dayRecords.forEach(record => {
            totalRecords++;
            if (record.status === 'Present') totalAttendance++;
          });
        });
      });
      const avgAttendance = totalRecords > 0 ? Math.round((totalAttendance / totalRecords) * 100) : 0;
      document.getElementById('avgAttendance').textContent = avgAttendance + '%';
    }

    function navigateTo(section) {
      // Define allowed sections for teachers
      const allowedSections = {
        'dashboard': 'teacher-dashboard.html',
        'enrollment': 'enrollment.html',
        'attendance': 'attendance.html', 
        'marks': 'marks.html',
        'timetable': 'timetable.html',
        'fees': 'fees.html',
        'analytics': 'analytics.html'
      };
      
      // Check if section is allowed for teachers
      if (allowedSections[section]) {
        if (section === 'dashboard') {
          // Stay on current page for dashboard
          return;
        }
        window.location.href = allowedSections[section];
      } else {
        alert('Access denied! This feature is not available for teachers.');
      }
    }

    function logout() {
      sessionStorage.removeItem('currentUser');
      window.location.href = 'index.html';
    }

    function searchStudents() {
      const searchTerm = document.getElementById('searchInput').value.trim().toLowerCase();
      const resultsContainer = document.getElementById('searchResults');
      
      if (!searchTerm) {
        resultsContainer.innerHTML = '<div style="padding: 20px; text-align: center; color: #666;">Please enter a search term</div>';
        return;
      }

      const students = JSON.parse(localStorage.getItem('students')) || [];
      const filteredStudents = students.filter(student => 
        student.name.toLowerCase().includes(searchTerm) ||
        student.roll.toLowerCase().includes(searchTerm) ||
        student.class.toLowerCase().includes(searchTerm) ||
        student.section.toLowerCase().includes(searchTerm) ||
        (student.course && student.course.toLowerCase().includes(searchTerm))
      );

      if (filteredStudents.length === 0) {
        resultsContainer.innerHTML = '<div style="padding: 20px; text-align: center; color: #666;">No students found matching your search</div>';
        return;
      }

      let resultsHTML = '<div style="padding: 10px; background: #e9ecef; font-weight: 600; border-bottom: 1px solid #dee2e6;">Found ' + filteredStudents.length + ' student(s)</div>';
      
      filteredStudents.forEach(student => {
        const attendance = getStudentAttendance(student.roll);
        const marks = getStudentMarks(student.roll);
        
        resultsHTML += `
          <div style="padding: 15px; border-bottom: 1px solid #e9ecef; display: flex; justify-content: space-between; align-items: center;">
            <div style="flex: 1;">
              <div style="font-weight: 600; color: #333; margin-bottom: 5px;">${student.name}</div>
              <div style="font-size: 0.9rem; color: #666;">
                <span style="margin-right: 15px;">üìã Roll: ${student.roll}</span>
                <span style="margin-right: 15px;">üè´ Class: ${student.class} ${student.section}</span>
                ${student.course ? `<span style="margin-right: 15px;">üìö Course: ${student.course}</span>` : ''}
                ${student.contact ? `<span>üìû ${student.contact}</span>` : ''}
              </div>
            </div>
            <div style="display: flex; gap: 10px; align-items: center;">
              <div style="text-align: center; min-width: 60px;">
                <div style="font-size: 0.8rem; color: #666;">Attendance</div>
                <div style="font-weight: 600; color: ${attendance >= 75 ? '#28a745' : attendance >= 50 ? '#ffc107' : '#dc3545'};">${attendance}%</div>
              </div>
              <div style="text-align: center; min-width: 60px;">
                <div style="font-size: 0.8rem; color: #666;">Avg Marks</div>
                <div style="font-weight: 600; color: ${marks >= 80 ? '#28a745' : marks >= 60 ? '#ffc107' : '#dc3545'};">${marks}%</div>
              </div>
              <button onclick="viewStudentDetails('${student.roll}')" style="background: #667eea; color: white; border: none; padding: 8px 12px; border-radius: 6px; cursor: pointer; font-size: 0.8rem;">
                View Details
              </button>
            </div>
          </div>
        `;
      });

      resultsContainer.innerHTML = resultsHTML;
    }

    function clearSearch() {
      document.getElementById('searchInput').value = '';
      document.getElementById('searchResults').innerHTML = '';
    }

    function getStudentAttendance(rollNumber) {
      const attendance = JSON.parse(localStorage.getItem('attendance')) || {};
      let totalDays = 0;
      let presentDays = 0;

      Object.values(attendance).forEach(division => {
        Object.values(division).forEach(dayRecords => {
          const studentRecord = dayRecords.find(record => 
            record.roll === rollNumber || record.rollNumber === rollNumber
          );
          if (studentRecord) {
            totalDays++;
            if (studentRecord.status === 'Present') {
              presentDays++;
            }
          }
        });
      });

      return totalDays > 0 ? Math.round((presentDays / totalDays) * 100) : 0;
    }

    function getStudentMarks(rollNumber) {
      const marks = JSON.parse(localStorage.getItem('marks')) || {};
      
      // Marks are stored by roll number as key
      const studentMarks = marks[rollNumber];
      if (!studentMarks) {
        return 0;
      }

      let totalMarks = 0;
      let totalSubjects = 0;
      const subjects = ['english', 'math', 'science', 'social', 'computer'];
      
      subjects.forEach(subject => {
        if (studentMarks[subject] && !isNaN(parseInt(studentMarks[subject]))) {
          totalMarks += parseInt(studentMarks[subject]);
          totalSubjects++;
        }
      });

      return totalSubjects > 0 ? Math.round(totalMarks / totalSubjects) : 0;
    }

    function viewStudentDetails(rollNumber) {
      const students = JSON.parse(localStorage.getItem('students')) || [];
      const student = students.find(s => s.roll === rollNumber);
      
      if (!student) {
        alert('Student not found!');
        return;
      }

      const attendance = getStudentAttendance(rollNumber);
      const marks = getStudentMarks(rollNumber);
      
      const detailsHTML = `
        <div style="background: white; border-radius: 12px; padding: 20px; margin: 20px 0; box-shadow: 0 4px 15px rgba(0,0,0,0.1);">
          <h3 style="margin: 0 0 20px 0; color: #333; display: flex; align-items: center; gap: 10px;">
            üë§ Student Details
          </h3>
          <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px;">
            <div>
              <strong>Name:</strong> ${student.name}
            </div>
            <div>
              <strong>Roll Number:</strong> ${student.roll}
            </div>
            <div>
              <strong>Class:</strong> ${student.class} ${student.section}
            </div>
            ${student.course ? `<div><strong>Course:</strong> ${student.course}</div>` : ''}
            ${student.contact ? `<div><strong>Contact:</strong> ${student.contact}</div>` : ''}
            ${student.address ? `<div><strong>Address:</strong> ${student.address}</div>` : ''}
            <div>
              <strong>Attendance:</strong> <span style="color: ${attendance >= 75 ? '#28a745' : attendance >= 50 ? '#ffc107' : '#dc3545'}; font-weight: 600;">${attendance}%</span>
            </div>
            <div>
              <strong>Average Marks:</strong> <span style="color: ${marks >= 80 ? '#28a745' : marks >= 60 ? '#ffc107' : '#dc3545'}; font-weight: 600;">${marks}%</span>
            </div>
          </div>
        </div>
      `;

      // Create a modal or add to the page
      const modal = document.createElement('div');
      modal.style.cssText = `
        position: fixed; top: 0; left: 0; width: 100%; height: 100%; 
        background: rgba(0,0,0,0.5); display: flex; align-items: center; 
        justify-content: center; z-index: 1000;
      `;
      
      modal.innerHTML = `
        <div style="background: white; border-radius: 12px; padding: 20px; max-width: 600px; max-height: 80vh; overflow-y: auto; margin: 20px;">
          ${detailsHTML}
          <div style="text-align: center; margin-top: 20px;">
            <button onclick="this.closest('.modal').remove()" style="background: #6c757d; color: white; border: none; padding: 10px 20px; border-radius: 6px; cursor: pointer;">
              Close
            </button>
          </div>
        </div>
      `;
      
      modal.className = 'modal';
      document.body.appendChild(modal);
    }

    // Allow search on Enter key
    document.addEventListener('DOMContentLoaded', function() {
      const searchInput = document.getElementById('searchInput');
      if (searchInput) {
        searchInput.addEventListener('keypress', function(e) {
          if (e.key === 'Enter') {
            searchStudents();
          }
        });
      }
    });
  </script>
</body>
</html>
