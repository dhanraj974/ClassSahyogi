<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Fees Management ‚Ä¢ ClassSahyogi</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter&display=swap" rel="stylesheet">
  <style>
    html { scroll-behavior: smooth; }
    * { box-sizing: border-box; font-family: 'Inter', sans-serif; }
    body { margin: 0; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); min-height: 100vh; overflow-x: hidden; }
    .layout { display: flex; min-height: 100vh; }
    nav { width: 220px; background: #232946; color: #fff; display: flex; flex-direction: column; align-items: center; padding: 32px 0; }
    nav a { color: #fff; text-decoration: none; margin: 18px 0; display: flex; align-items: center; gap: 10px; font-size: 1.1rem; }
    header { height: 64px; background: rgba(255,255,255,0.95); box-shadow: 0 2px 12px rgba(35,41,70,0.06); display: flex; align-items: center; padding: 0 20px; color: #232946; font-weight: 500; gap: 12px; }
    .card { background: rgba(255,255,255,0.98); border-radius: 18px; box-shadow: 0 8px 32px rgba(35,41,70,0.10); margin: 16px; padding: 20px; min-height: calc(100vh - 120px); flex: 1; overflow-y: auto; }
    button { background: #007bff; color: #fff; border: none; border-radius: 8px; padding: 10px 16px; cursor: pointer; }
    select, input { padding: 8px 12px; border-radius: 6px; border: 1px solid #ddd; margin: 4px; }
    table { width: 100%; border-collapse: collapse; margin-top: 16px; }
    th, td { padding: 12px; text-align: left; border-bottom: 1px solid #eee; }
    th { background: #f8f9fa; font-weight: 600; }
    .stats { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 16px; margin-bottom: 24px; }
    .stat-card { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 20px; border-radius: 12px; text-align: center; }
    .stat-value { font-size: 2rem; font-weight: bold; margin-bottom: 8px; }
    .form-section { background: linear-gradient(135deg, #a8edea 0%, #fed6e3 100%); padding: 20px; border-radius: 12px; margin-bottom: 20px; }
    
    /* Responsive Design */
    @media (max-width: 768px) {
      .layout { flex-direction: column; }
      nav { width: 100%; height: auto; padding: 16px 0; }
      nav a { margin: 8px 0; font-size: 1rem; }
      .card { margin: 8px; padding: 16px; }
      header { padding: 0 16px; font-size: 1.1rem; }
      .stats { grid-template-columns: 1fr 1fr; }
    }
    
    @media (max-width: 480px) {
      .stats { grid-template-columns: 1fr; }
    }
  </style>
</head>
<body>
  <div class="layout">
    <nav>
      <div style="display:flex;flex-direction:column;align-items:center;gap:8px;margin-bottom:40px;">
        <div style="width:180px;height:100px;background:linear-gradient(135deg,#1e3c72 0%,#2a5298 50%,#ff6b6b 100%);border-radius:20px;display:flex;flex-direction:column;align-items:center;justify-content:center;box-shadow:0 8px 25px rgba(30,60,114,0.4);padding:16px;position:relative;overflow:hidden;">
          <!-- Geometric Background Pattern -->
          <div style="position:absolute;top:-10px;right:-10px;width:40px;height:40px;background:rgba(255,255,255,0.1);border-radius:50%;transform:rotate(45deg);"></div>
          <div style="position:absolute;bottom:-15px;left:-15px;width:30px;height:30px;background:rgba(255,255,255,0.08);border-radius:50%;transform:rotate(-30deg);"></div>
          
          <!-- Main Logo Icon -->
          <div style="width:50px;height:50px;background:rgba(255,255,255,0.95);border-radius:12px;display:flex;align-items:center;justify-content:center;margin-bottom:8px;box-shadow:0 4px 15px rgba(0,0,0,0.2);">
            <div style="width:30px;height:30px;background:linear-gradient(45deg,#ff6b6b,#4ecdc4);border-radius:8px;display:flex;align-items:center;justify-content:center;position:relative;">
              <div style="width:20px;height:20px;background:#fff;border-radius:4px;display:flex;align-items:center;justify-content:center;">
                <div style="width:12px;height:12px;background:linear-gradient(45deg,#ff6b6b,#4ecdc4);border-radius:2px;position:relative;">
                  <div style="position:absolute;top:2px;left:2px;width:4px;height:4px;background:#fff;border-radius:1px;"></div>
                  <div style="position:absolute;bottom:2px;right:2px;width:4px;height:4px;background:#fff;border-radius:1px;"></div>
                </div>
              </div>
            </div>
          </div>
          
          <!-- Brand Text -->
          <div style="font-size:1.4rem;font-weight:800;color:#fff;text-align:center;line-height:1.1;letter-spacing:2px;text-shadow:0 2px 4px rgba(0,0,0,0.3);">
            <span style="color:#FFD700;text-shadow:0 0 10px rgba(255,215,0,0.5);">CS</span>
          </div>
          <div style="font-size:0.6rem;color:rgba(255,255,255,0.9);font-weight:500;margin-top:2px;letter-spacing:1px;">
            ClassSahyogi
          </div>
        </div>
      </div>
      <a href="index.html"><span>üè†</span> Dashboard</a>
      <a href="enrollment.html"><span>üìù</span> Enrollment</a>
      <a href="fees.html"><span>üí∞</span> Fees</a>
      <a href="timetable.html"><span>üìÖ</span> Timetable</a>
      <a href="staff.html"><span>üë•</span> Staff</a>
      <a href="analytics.html"><span>üìä</span> Analytics</a>
      <a href="attendance.html"><span>üßæ</span> Attendance</a>
      <a href="marks.html"><span>üéì</span> Marks</a>
    </nav>
    <div style="flex:1;display:flex;flex-direction:column;min-height:100vh;">
      <header>
        <div style="width:140px;height:45px;background:linear-gradient(135deg,#1e3c72 0%,#2a5298 50%,#ff6b6b 100%);border-radius:12px;display:flex;align-items:center;justify-content:center;margin-right:12px;padding:8px;position:relative;overflow:hidden;box-shadow:0 4px 15px rgba(30,60,114,0.3);">
          <!-- Mini Geometric Pattern -->
          <div style="position:absolute;top:-5px;right:-5px;width:20px;height:20px;background:rgba(255,255,255,0.1);border-radius:50%;transform:rotate(45deg);"></div>
          
          <!-- Mini Logo Icon -->
          <div style="width:25px;height:25px;background:rgba(255,255,255,0.95);border-radius:6px;display:flex;align-items:center;justify-content:center;margin-right:8px;box-shadow:0 2px 8px rgba(0,0,0,0.2);">
            <div style="width:15px;height:15px;background:linear-gradient(45deg,#ff6b6b,#4ecdc4);border-radius:4px;position:relative;">
              <div style="position:absolute;top:1px;left:1px;width:2px;height:2px;background:#fff;border-radius:1px;"></div>
              <div style="position:absolute;bottom:1px;right:1px;width:2px;height:2px;background:#fff;border-radius:1px;"></div>
            </div>
          </div>
          
          <!-- Brand Text -->
          <div style="font-size:0.9rem;font-weight:800;color:#fff;letter-spacing:1px;text-shadow:0 1px 3px rgba(0,0,0,0.3);">
            <span style="color:#FFD700;text-shadow:0 0 8px rgba(255,215,0,0.4);">CS</span>
          </div>
        </div>
        <span>üí∞ ClassSahyogi - Fees Management</span>
      </header>
      <div class="card">
        <a href="javascript:void(0)" onclick="goToDashboard()" style="display:inline-block; margin-bottom:12px; background:#e5e7eb; color:#111827; padding:8px 14px; border-radius:8px; text-decoration:none;">‚Üê Back to Dashboard</a>
        
        <!-- Stats Overview -->
        <div class="stats">
          <div class="stat-card">
            <div class="stat-value" id="totalFees">‚Çπ0</div>
            <div>Total Collected</div>
          </div>
          <div class="stat-card">
            <div class="stat-value" id="pendingFees">‚Çπ0</div>
            <div>Pending Fees</div>
          </div>
          <div class="stat-card">
            <div class="stat-value" id="studentsPaid">0</div>
            <div>Students Paid</div>
          </div>
          <div class="stat-card">
            <div class="stat-value" id="studentsPending">0</div>
            <div>Students Pending</div>
          </div>
        </div>

        <!-- Add Fee Payment -->
        <div class="form-section">
          <h4 style="margin-top: 0; color: #333;">üí≥ Record Fee Payment</h4>
          <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 12px;">
            <select id="studentSelect">
              <option value="">Select Student</option>
            </select>
            <input type="number" id="amount" placeholder="Amount (‚Çπ)">
            <input type="date" id="paymentDate">
            <select id="paymentMethod">
              <option value="Cash">Cash</option>
              <option value="Online">Online</option>
              <option value="Cheque">Cheque</option>
              <option value="Card">Card</option>
            </select>
            <input type="text" id="remarks" placeholder="Remarks (optional)">
            <button onclick="recordPayment()" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);">Record Payment</button>
          </div>
        </div>

        <!-- Fee Records -->
        <div style="background: linear-gradient(135deg, #ffecd2 0%, #fcb69f 100%); padding: 20px; border-radius: 12px; margin-bottom: 20px;">
          <h4 style="margin-top: 0; color: #333;">üìã Fee Records</h4>
          <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 12px; margin-bottom: 16px;">
            <select id="filterClass">
              <option value="">All Classes</option>
            </select>
            <select id="filterStatus">
              <option value="">All Status</option>
              <option value="Paid">Paid</option>
              <option value="Pending">Pending</option>
            </select>
            <button onclick="filterRecords()" style="background: linear-gradient(135deg, #ff9a9e 0%, #fecfef 100%);">Filter</button>
            <button onclick="exportFees()" style="background: linear-gradient(135deg, #a8edea 0%, #fed6e3 100%);">Export CSV</button>
          </div>
          <table id="feesTable">
            <thead>
              <tr>
                <th>Student</th>
                <th>Class</th>
                <th>Amount</th>
                <th>Date</th>
                <th>Method</th>
                <th>Status</th>
                <th>Remarks</th>
              </tr>
            </thead>
            <tbody></tbody>
          </table>
        </div>
      </div>
    </div>
  </div>

  <script>
    function goToDashboard() {
      const currentUser = JSON.parse(sessionStorage.getItem('currentUser') || '{}');
      
      if (currentUser.role === 'admin') {
        window.location.href = 'admin-dashboard.html';
      } else if (currentUser.role === 'teacher') {
        window.location.href = 'teacher-dashboard.html';
      } else if (currentUser.role === 'student') {
        window.location.href = 'student-dashboard.html';
      } else {
        // No user logged in, go to main page
        window.location.href = 'index.html';
      }
    }

    let feesData = JSON.parse(localStorage.getItem('feesData')) || [];
    let students = JSON.parse(localStorage.getItem('students')) || [];

    function loadStudents() {
      const select = document.getElementById('studentSelect');
      const filterClass = document.getElementById('filterClass');
      const classes = [...new Set(students.map(s => s.class))];
      
      select.innerHTML = '<option value="">Select Student</option>' + 
        students.map(s => `<option value="${s.roll}">${s.name} (${s.roll}) - ${s.class}</option>`).join('');
      
      filterClass.innerHTML = '<option value="">All Classes</option>' + 
        classes.map(c => `<option value="${c}">${c}</option>`).join('');
    }

    function recordPayment() {
      const studentRoll = document.getElementById('studentSelect').value;
      const amount = parseFloat(document.getElementById('amount').value);
      const paymentDate = document.getElementById('paymentDate').value;
      const method = document.getElementById('paymentMethod').value;
      const remarks = document.getElementById('remarks').value;

      if (!studentRoll || !amount || !paymentDate) {
        alert('Please fill all required fields');
        return;
      }

      const student = students.find(s => s.roll === studentRoll);
      if (!student) {
        alert('Student not found');
        return;
      }

      const payment = {
        id: Date.now(),
        studentRoll,
        studentName: student.name,
        studentClass: student.class,
        amount,
        paymentDate,
        method,
        remarks,
        status: 'Paid',
        timestamp: new Date().toISOString()
      };

      feesData.push(payment);
      localStorage.setItem('feesData', JSON.stringify(feesData));
      
      alert('Payment recorded successfully!');
      document.getElementById('studentSelect').value = '';
      document.getElementById('amount').value = '';
      document.getElementById('paymentDate').value = '';
      document.getElementById('remarks').value = '';
      
      updateStats();
      loadFeesTable();
    }

    function loadFeesTable() {
      const tbody = document.querySelector('#feesTable tbody');
      const filterClass = document.getElementById('filterClass').value;
      const filterStatus = document.getElementById('filterStatus').value;
      
      let filtered = feesData;
      if (filterClass) filtered = filtered.filter(f => f.studentClass === filterClass);
      if (filterStatus) filtered = filtered.filter(f => f.status === filterStatus);
      
      tbody.innerHTML = filtered.map(fee => `
        <tr>
          <td>${fee.studentName}</td>
          <td>${fee.studentClass}</td>
          <td>‚Çπ${fee.amount}</td>
          <td>${fee.paymentDate}</td>
          <td>${fee.method}</td>
          <td><span style="color: ${fee.status === 'Paid' ? 'green' : 'red'}">${fee.status}</span></td>
          <td>${fee.remarks || '-'}</td>
        </tr>
      `).join('');
    }

    function updateStats() {
      const paid = feesData.filter(f => f.status === 'Paid');
      const totalCollected = paid.reduce((sum, f) => sum + f.amount, 0);
      const studentsPaid = new Set(paid.map(f => f.studentRoll)).size;
      const studentsPending = students.length - studentsPaid;
      const pendingAmount = studentsPending * 1000; // Assuming ‚Çπ1000 per student

      document.getElementById('totalFees').textContent = `‚Çπ${totalCollected.toLocaleString()}`;
      document.getElementById('pendingFees').textContent = `‚Çπ${pendingAmount.toLocaleString()}`;
      document.getElementById('studentsPaid').textContent = studentsPaid;
      document.getElementById('studentsPending').textContent = studentsPending;
    }

    function filterRecords() {
      loadFeesTable();
    }

    function exportFees() {
      const csv = [
        ['Student Name', 'Class', 'Amount', 'Date', 'Method', 'Status', 'Remarks'],
        ...feesData.map(f => [f.studentName, f.studentClass, f.amount, f.paymentDate, f.method, f.status, f.remarks])
      ].map(row => row.join(',')).join('\n');
      
      const blob = new Blob([csv], { type: 'text/csv' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = `fees_export_${new Date().toISOString().split('T')[0]}.csv`;
      a.click();
    }

    // Initialize
    loadStudents();
    updateStats();
    loadFeesTable();
  </script>
</body>
</html>
