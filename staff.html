<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Staff Management ‚Ä¢ ClassSahyogi</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter&display=swap" rel="stylesheet">
  <style>
    html { scroll-behavior: smooth; }
    * { box-sizing: border-box; font-family: 'Inter', sans-serif; }
    body { margin: 0; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); min-height: 100vh; overflow-x: hidden; }
    .layout { display: flex; min-height: 100vh; }
    nav { width: 220px; background: #232946; color: #fff; display: flex; flex-direction: column; align-items: center; padding: 32px 0; }
    nav a { color: #fff; text-decoration: none; margin: 18px 0; display: flex; align-items: center; gap: 10px; font-size: 1.1rem; }
    header { height: 64px; background: rgba(255,255,255,0.95); box-shadow: 0 2px 12px rgba(35,41,70,0.06); display: flex; align-items: center; padding: 0 36px; color: #232946; font-weight: 500; gap: 12px; }
    .card { background: rgba(255,255,255,0.98); border-radius: 18px; box-shadow: 0 8px 32px rgba(35,41,70,0.10); margin: 32px 48px; padding: 36px 48px; min-height: 80vh; flex: 1; }
    button { background: #007bff; color: #fff; border: none; border-radius: 8px; padding: 10px 16px; cursor: pointer; }
    select, input, textarea { padding: 8px 12px; border-radius: 6px; border: 1px solid #ddd; margin: 4px; width: 100%; }
    table { width: 100%; border-collapse: collapse; margin-top: 16px; }
    th, td { padding: 12px; text-align: left; border-bottom: 1px solid #eee; }
    th { background: #f8f9fa; font-weight: 600; }
    .stats { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 16px; margin-bottom: 24px; }
    .stat-card { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 20px; border-radius: 12px; text-align: center; }
    .stat-value { font-size: 2rem; font-weight: bold; margin-bottom: 8px; }
    .form-section { background: linear-gradient(135deg, #a8edea 0%, #fed6e3 100%); padding: 20px; border-radius: 12px; margin-bottom: 20px; }
    .staff-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 16px; margin-top: 20px; }
    .staff-card { background: white; border-radius: 12px; padding: 20px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); }
    .staff-photo { width: 80px; height: 80px; border-radius: 50%; object-fit: cover; margin-bottom: 12px; }
  </style>
</head>
<body>
  <div class="layout">
    <nav>
      <div style="display:flex;flex-direction:column;align-items:center;gap:8px;margin-bottom:40px;">
        <div style="width:180px;height:100px;background:linear-gradient(135deg,#1e3c72 0%,#2a5298 50%,#ff6b6b 100%);border-radius:20px;display:flex;flex-direction:column;align-items:center;justify-content:center;box-shadow:0 8px 25px rgba(30,60,114,0.4);padding:16px;position:relative;overflow:hidden;">
          <!-- Geometric Background Pattern -->
          <div style="position:absolute;top:-10px;right:-10px;width:40px;height:40px;background:rgba(255,255,255,0.1);border-radius:50%;transform:rotate(45deg);"></div>
          <div style="position:absolute;bottom:-15px;left:-15px;width:30px;height:30px;background:rgba(255,255,255,0.08);border-radius:50%;transform:rotate(-30deg);"></div>
          
          <!-- Main Logo Icon -->
          <div style="width:50px;height:50px;background:rgba(255,255,255,0.95);border-radius:12px;display:flex;align-items:center;justify-content:center;margin-bottom:8px;box-shadow:0 4px 15px rgba(0,0,0,0.2);">
            <div style="width:30px;height:30px;background:linear-gradient(45deg,#ff6b6b,#4ecdc4);border-radius:8px;display:flex;align-items:center;justify-content:center;position:relative;">
              <div style="width:20px;height:20px;background:#fff;border-radius:4px;display:flex;align-items:center;justify-content:center;">
                <div style="width:12px;height:12px;background:linear-gradient(45deg,#ff6b6b,#4ecdc4);border-radius:2px;position:relative;">
                  <div style="position:absolute;top:2px;left:2px;width:4px;height:4px;background:#fff;border-radius:1px;"></div>
                  <div style="position:absolute;bottom:2px;right:2px;width:4px;height:4px;background:#fff;border-radius:1px;"></div>
                </div>
              </div>
            </div>
          </div>
          
          <!-- Brand Text -->
          <div style="font-size:1.4rem;font-weight:800;color:#fff;text-align:center;line-height:1.1;letter-spacing:2px;text-shadow:0 2px 4px rgba(0,0,0,0.3);">
            <span style="color:#FFD700;text-shadow:0 0 10px rgba(255,215,0,0.5);">CS</span>
          </div>
          <div style="font-size:0.6rem;color:rgba(255,255,255,0.9);font-weight:500;margin-top:2px;letter-spacing:1px;">
            ClassSahyogi
          </div>
        </div>
      </div>
      <a href="index.html"><span>üè†</span> Dashboard</a>
      <a href="enrollment.html"><span>üìù</span> Enrollment</a>
      <a href="fees.html"><span>üí∞</span> Fees</a>
      <a href="timetable.html"><span>üìÖ</span> Timetable</a>
      <a href="staff.html"><span>üë•</span> Staff</a>
      <a href="analytics.html"><span>üìä</span> Analytics</a>
      <a href="attendance.html"><span>üßæ</span> Attendance</a>
      <a href="marks.html"><span>üéì</span> Marks</a>
    </nav>
    <div style="flex:1;display:flex;flex-direction:column;min-height:100vh;">
      <header>
        <div style="width:140px;height:45px;background:linear-gradient(135deg,#1e3c72 0%,#2a5298 50%,#ff6b6b 100%);border-radius:12px;display:flex;align-items:center;justify-content:center;margin-right:12px;padding:8px;position:relative;overflow:hidden;box-shadow:0 4px 15px rgba(30,60,114,0.3);">
          <!-- Mini Geometric Pattern -->
          <div style="position:absolute;top:-5px;right:-5px;width:20px;height:20px;background:rgba(255,255,255,0.1);border-radius:50%;transform:rotate(45deg);"></div>
          
          <!-- Mini Logo Icon -->
          <div style="width:25px;height:25px;background:rgba(255,255,255,0.95);border-radius:6px;display:flex;align-items:center;justify-content:center;margin-right:8px;box-shadow:0 2px 8px rgba(0,0,0,0.2);">
            <div style="width:15px;height:15px;background:linear-gradient(45deg,#ff6b6b,#4ecdc4);border-radius:4px;position:relative;">
              <div style="position:absolute;top:1px;left:1px;width:2px;height:2px;background:#fff;border-radius:1px;"></div>
              <div style="position:absolute;bottom:1px;right:1px;width:2px;height:2px;background:#fff;border-radius:1px;"></div>
            </div>
          </div>
          
          <!-- Brand Text -->
          <div style="font-size:0.9rem;font-weight:800;color:#fff;letter-spacing:1px;text-shadow:0 1px 3px rgba(0,0,0,0.3);">
            <span style="color:#FFD700;text-shadow:0 0 8px rgba(255,215,0,0.4);">CS</span>
          </div>
        </div>
        <span>üë• ClassSahyogi - Staff Management</span>
      </header>
      <div class="card">
        <a href="javascript:void(0)" onclick="goToDashboard()" style="display:inline-block; margin-bottom:12px; background:#e5e7eb; color:#111827; padding:8px 14px; border-radius:8px; text-decoration:none;">‚Üê Back to Dashboard</a>
        
        <!-- Stats Overview -->
        <div class="stats">
          <div class="stat-card">
            <div class="stat-value" id="totalStaff">0</div>
            <div>Total Staff</div>
          </div>
          <div class="stat-card">
            <div class="stat-value" id="teachers">0</div>
            <div>Teachers</div>
          </div>
          <div class="stat-card">
            <div class="stat-value" id="adminStaff">0</div>
            <div>Admin Staff</div>
          </div>
          <div class="stat-card">
            <div class="stat-value" id="supportStaff">0</div>
            <div>Support Staff</div>
          </div>
        </div>

        <!-- Add Staff Member -->
        <div class="form-section">
          <h4 style="margin-top: 0; color: #333;">üë§ Add Staff Member</h4>
          <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 12px;">
            <input type="text" id="staffName" placeholder="Full Name" required>
            <div style="display: flex; gap: 8px; align-items: center;">
              <input type="text" id="staffId" placeholder="Staff ID" readonly style="background: #f8f9fa; color: #6c757d;">
              <button type="button" onclick="generateStaffId()" style="background: #28a745; color: white; padding: 8px 12px; border: none; border-radius: 6px; cursor: pointer; white-space: nowrap; font-size: 0.9rem;">Generate ID</button>
            </div>
            <select id="staffRole" required>
              <option value="">Select Role</option>
              <option value="Teacher">Teacher</option>
              <option value="Principal">Principal</option>
              <option value="Vice Principal">Vice Principal</option>
              <option value="Admin">Admin Staff</option>
              <option value="Accountant">Accountant</option>
              <option value="Librarian">Librarian</option>
              <option value="Support">Support Staff</option>
            </select>
            <input type="text" id="department" placeholder="Department/Subject" required>
            <input type="email" id="email" placeholder="Email" required>
            <input type="tel" id="phone" placeholder="Phone Number" required>
            <input type="date" id="joinDate" placeholder="Join Date" required>
            <input type="number" id="salary" placeholder="Salary (‚Çπ)" required>
            <input type="file" id="staffPhoto" accept="image/*">
            <textarea id="address" placeholder="Address" rows="3" required></textarea>
            <textarea id="qualification" placeholder="Qualifications" rows="2" required></textarea>
            <button onclick="addStaff()" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);">Add Staff Member</button>
          </div>
          <div id="staffIdMessage" style="margin-top: 10px; padding: 8px; border-radius: 6px; display: none;"></div>
        </div>

        <!-- Staff List -->
        <div style="background: linear-gradient(135deg, #ffecd2 0%, #fcb69f 100%); padding: 20px; border-radius: 12px; margin-bottom: 20px;">
          <h4 style="margin-top: 0; color: #333;">üë• Staff Directory</h4>
          <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 12px; margin-bottom: 16px;">
            <select id="filterRole">
              <option value="">All Roles</option>
              <option value="Teacher">Teacher</option>
              <option value="Principal">Principal</option>
              <option value="Vice Principal">Vice Principal</option>
              <option value="Admin">Admin Staff</option>
              <option value="Accountant">Accountant</option>
              <option value="Librarian">Librarian</option>
              <option value="Support">Support Staff</option>
            </select>
            <input type="text" id="searchStaff" placeholder="Search by name or ID">
            <button onclick="filterStaff()" style="background: linear-gradient(135deg, #ff9a9e 0%, #fecfef 100%);">Filter</button>
            <button onclick="exportStaff()" style="background: linear-gradient(135deg, #a8edea 0%, #fed6e3 100%);">Export CSV</button>
          </div>
          <div id="staffContainer"></div>
        </div>
      </div>
    </div>
  </div>

  <script>
    // Check admin access - check both sessionStorage and localStorage for consistency
    const currentUser = JSON.parse(sessionStorage.getItem('currentUser') || '{}');
    const adminLoggedIn = localStorage.getItem('adminLoggedIn');
    
    if ((!currentUser || currentUser.role !== 'admin') && (!adminLoggedIn || adminLoggedIn !== 'true')) {
      alert('Access denied. This page requires administrator privileges.');
      window.location.href = 'index.html';
    }

    function goToDashboard() {
      const currentUser = JSON.parse(sessionStorage.getItem('currentUser') || '{}');
      
      if (currentUser.role === 'admin') {
        window.location.href = 'admin-dashboard.html';
      } else if (currentUser.role === 'teacher') {
        window.location.href = 'teacher-dashboard.html';
      } else if (currentUser.role === 'student') {
        window.location.href = 'student-dashboard.html';
      } else {
        // No user logged in, go to main page
        window.location.href = 'index.html';
      }
    }

    let staffData = JSON.parse(localStorage.getItem('staffData')) || [];

    // Generate unique Staff ID
    function generateStaffId() {
      const messageDiv = document.getElementById('staffIdMessage');
      const staffIdInput = document.getElementById('staffId');
      
      // Get the next available staff number
      const existingIds = staffData.map(staff => staff.staffId).filter(id => id && id.startsWith('STF'));
      let nextNumber = 1;
      
      // Find the highest existing number
      existingIds.forEach(id => {
        const match = id.match(/STF(\d+)/);
        if (match) {
          const num = parseInt(match[1]);
          if (num >= nextNumber) {
            nextNumber = num + 1;
          }
        }
      });
      
      // Generate new ID with padding (e.g., STF001, STF002, etc.)
      const newId = `STF${nextNumber.toString().padStart(3, '0')}`;
      
      // Check if ID already exists (extra safety)
      if (existingIds.includes(newId)) {
        nextNumber++;
        const finalId = `STF${nextNumber.toString().padStart(3, '0')}`;
        staffIdInput.value = finalId;
      } else {
        staffIdInput.value = newId;
      }
      
      // Show success message
      const password = staffIdInput.value + '@123';
      messageDiv.style.display = 'block';
      messageDiv.style.background = '#d4edda';
      messageDiv.style.color = '#155724';
      messageDiv.style.border = '1px solid #c3e6cb';
      messageDiv.innerHTML = `
        ‚úÖ Generated Staff ID: <strong>${staffIdInput.value}</strong><br>
        üîë Login Password: <strong>${password}</strong><br>
        <small>Note: Teacher can use this ID and password to login</small>
      `;
      
      // Auto-hide message after 3 seconds
      setTimeout(() => {
        messageDiv.style.display = 'none';
      }, 3000);
    }

    // Auto-generate Staff ID when page loads
    function autoGenerateStaffId() {
      const staffIdInput = document.getElementById('staffId');
      if (!staffIdInput.value) {
        generateStaffId();
      }
    }

    // Clear form after successful addition
    function clearStaffForm() {
      document.getElementById('staffName').value = '';
      document.getElementById('staffId').value = '';
      document.getElementById('staffRole').value = '';
      document.getElementById('department').value = '';
      document.getElementById('email').value = '';
      document.getElementById('phone').value = '';
      document.getElementById('joinDate').value = '';
      document.getElementById('salary').value = '';
      document.getElementById('address').value = '';
      document.getElementById('qualification').value = '';
      document.getElementById('staffPhoto').value = '';
      
      // Auto-generate new ID for next staff member
      setTimeout(() => {
        generateStaffId();
      }, 500);
    }

    function addStaff() {
      const name = document.getElementById('staffName').value.trim();
      const staffId = document.getElementById('staffId').value.trim();
      const role = document.getElementById('staffRole').value;
      const department = document.getElementById('department').value.trim();
      const email = document.getElementById('email').value.trim();
      const phone = document.getElementById('phone').value.trim();
      const joinDate = document.getElementById('joinDate').value;
      const salary = parseFloat(document.getElementById('salary').value) || 0;
      const address = document.getElementById('address').value.trim();
      const qualification = document.getElementById('qualification').value.trim();
      const photoInput = document.getElementById('staffPhoto');

      if (!name || !staffId || !role || !email || !phone) {
        alert('Please fill all required fields');
        return;
      }

      // Check if Staff ID has been generated
      if (!staffId || !staffId.startsWith('STF')) {
        alert('Please generate a Staff ID first by clicking the "Generate ID" button.');
        return;
      }

      if (staffData.find(s => s.staffId === staffId)) {
        alert('Staff ID already exists. Please generate a new ID.');
        return;
      }

      // Generate a default password for teacher login
      const password = staffId + '@123'; // Default password format: STF001@123
      
      const staff = {
        id: staffId, // Use staffId as the unique ID for login
        name,
        staffId,
        role,
        department,
        email,
        phone,
        joinDate,
        salary,
        address,
        qualification,
        photo: '',
        password: password, // Add password for login
        timestamp: new Date().toISOString()
      };

      // Handle photo upload
      if (photoInput.files && photoInput.files[0]) {
        const reader = new FileReader();
        reader.onload = function(e) {
          staff.photo = e.target.result;
          staffData.push(staff);
          localStorage.setItem('staffData', JSON.stringify(staffData));
          alert('Staff member added successfully!');
          clearStaffForm();
          updateStats();
          loadStaff();
        };
        reader.readAsDataURL(photoInput.files[0]);
      } else {
        staffData.push(staff);
        localStorage.setItem('staffData', JSON.stringify(staffData));
        alert('Staff member added successfully!');
        clearStaffForm();
        updateStats();
        loadStaff();
      }
    }

    function clearForm() {
      document.getElementById('staffName').value = '';
      document.getElementById('staffId').value = '';
      document.getElementById('staffRole').value = '';
      document.getElementById('department').value = '';
      document.getElementById('email').value = '';
      document.getElementById('phone').value = '';
      document.getElementById('joinDate').value = '';
      document.getElementById('salary').value = '';
      document.getElementById('address').value = '';
      document.getElementById('qualification').value = '';
      document.getElementById('staffPhoto').value = '';
    }

    function loadStaff() {
      const filterRole = document.getElementById('filterRole').value;
      const searchTerm = document.getElementById('searchStaff').value.toLowerCase();
      
      let filtered = staffData;
      if (filterRole) filtered = filtered.filter(s => s.role === filterRole);
      if (searchTerm) filtered = filtered.filter(s => 
        s.name.toLowerCase().includes(searchTerm) || 
        s.staffId.toLowerCase().includes(searchTerm)
      );

      const container = document.getElementById('staffContainer');
      container.innerHTML = filtered.map(staff => `
        <div class="staff-card">
          <div style="display: flex; align-items: center; margin-bottom: 12px;">
            <img src="${staff.photo || 'https://via.placeholder.com/80x80?text=üë§'}" 
                 alt="${staff.name}" class="staff-photo">
            <div style="margin-left: 16px;">
              <h4 style="margin: 0; color: #333;">${staff.name}</h4>
              <p style="margin: 4px 0; color: #666; font-size: 0.9rem;">${staff.role} ‚Ä¢ ${staff.staffId}</p>
            </div>
          </div>
          <div style="font-size: 0.9rem; color: #666;">
            <p><strong>Department:</strong> ${staff.department || 'N/A'}</p>
            <p><strong>Email:</strong> ${staff.email}</p>
            <p><strong>Phone:</strong> ${staff.phone}</p>
            <p><strong>Join Date:</strong> ${staff.joinDate || 'N/A'}</p>
            <p><strong>Salary:</strong> ‚Çπ${staff.salary.toLocaleString()}</p>
            ${staff.qualification ? `<p><strong>Qualification:</strong> ${staff.qualification}</p>` : ''}
            ${staff.address ? `<p><strong>Address:</strong> ${staff.address}</p>` : ''}
          </div>
          <div style="margin-top: 12px;">
            <button onclick="editStaff(${staff.id})" style="background: #28a745; margin-right: 8px; font-size: 0.8rem; padding: 6px 12px;">Edit</button>
            <button onclick="deleteStaff(${staff.id})" style="background: #dc3545; font-size: 0.8rem; padding: 6px 12px;">Delete</button>
          </div>
        </div>
      `).join('');
    }

    function editStaff(staffId) {
      const staff = staffData.find(s => s.id === staffId);
      if (!staff) return;

      document.getElementById('staffName').value = staff.name;
      document.getElementById('staffId').value = staff.staffId;
      document.getElementById('staffRole').value = staff.role;
      document.getElementById('department').value = staff.department || '';
      document.getElementById('email').value = staff.email;
      document.getElementById('phone').value = staff.phone;
      document.getElementById('joinDate').value = staff.joinDate || '';
      document.getElementById('salary').value = staff.salary || '';
      document.getElementById('address').value = staff.address || '';
      document.getElementById('qualification').value = staff.qualification || '';

      // Scroll to form
      document.querySelector('.form-section').scrollIntoView({ behavior: 'smooth' });
    }

    function deleteStaff(staffId) {
      if (confirm('Are you sure you want to delete this staff member?')) {
        staffData = staffData.filter(s => s.id !== staffId);
        localStorage.setItem('staffData', JSON.stringify(staffData));
        updateStats();
        loadStaff();
        alert('Staff member deleted successfully!');
      }
    }

    function filterStaff() {
      loadStaff();
    }

    function updateStats() {
      const total = staffData.length;
      const teachers = staffData.filter(s => s.role === 'Teacher').length;
      const admin = staffData.filter(s => ['Principal', 'Vice Principal', 'Admin', 'Accountant', 'Librarian'].includes(s.role)).length;
      const support = staffData.filter(s => s.role === 'Support').length;

      document.getElementById('totalStaff').textContent = total;
      document.getElementById('teachers').textContent = teachers;
      document.getElementById('adminStaff').textContent = admin;
      document.getElementById('supportStaff').textContent = support;
    }

    function exportStaff() {
      const csv = [
        ['Name', 'Staff ID', 'Role', 'Department', 'Email', 'Phone', 'Join Date', 'Salary', 'Qualification', 'Address'],
        ...staffData.map(s => [s.name, s.staffId, s.role, s.department || '', s.email, s.phone, s.joinDate || '', s.salary, s.qualification || '', s.address || ''])
      ].map(row => row.join(',')).join('\n');
      
      const blob = new Blob([csv], { type: 'text/csv' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = `staff_export_${new Date().toISOString().split('T')[0]}.csv`;
      a.click();
    }

    // Initialize
    updateStats();
    loadStaff();
    
    // Auto-generate Staff ID when page loads
    document.addEventListener('DOMContentLoaded', function() {
      autoGenerateStaffId();
    });
  </script>
</body>
</html>
