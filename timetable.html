<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Timetable ‚Ä¢ ClassSahyogi</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter&display=swap" rel="stylesheet">
  <style>
    html { scroll-behavior: smooth; }
    * { box-sizing: border-box; font-family: 'Inter', sans-serif; }
    body { margin: 0; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); min-height: 100vh; overflow-x: hidden; }
    .layout { display: flex; min-height: 100vh; }
    nav { width: 220px; background: #232946; color: #fff; display: flex; flex-direction: column; align-items: center; padding: 32px 0; }
    nav a { color: #fff; text-decoration: none; margin: 18px 0; display: flex; align-items: center; gap: 10px; font-size: 1.1rem; }
    header { height: 64px; background: rgba(255,255,255,0.95); box-shadow: 0 2px 12px rgba(35,41,70,0.06); display: flex; align-items: center; padding: 0 36px; color: #232946; font-weight: 500; gap: 12px; }
    .card { background: rgba(255,255,255,0.98); border-radius: 18px; box-shadow: 0 8px 32px rgba(35,41,70,0.10); margin: 32px 48px; padding: 36px 48px; min-height: 80vh; flex: 1; }
    button { background: #007bff; color: #fff; border: none; border-radius: 8px; padding: 10px 16px; cursor: pointer; }
    select, input { padding: 8px 12px; border-radius: 6px; border: 1px solid #ddd; margin: 4px; }
    .timetable { display: grid; grid-template-columns: 80px repeat(7, 1fr); gap: 1px; background: #ddd; margin-top: 20px; }
    .time-slot, .subject-cell { padding: 12px 8px; background: white; text-align: center; font-size: 0.9rem; }
    .time-slot { background: #f8f9fa; font-weight: bold; }
    .subject-cell { cursor: pointer; transition: all 0.2s; }
    .subject-cell:hover { background: #e3f2fd; }
    .subject-cell.editable { background: #fff3e0; }
    .form-section { background: linear-gradient(135deg, #a8edea 0%, #fed6e3 100%); padding: 20px; border-radius: 12px; margin-bottom: 20px; }
    .day-header { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; font-weight: bold; }
  </style>
</head>
<body>
  <div class="layout">
    <nav>
      <div style="display:flex;flex-direction:column;align-items:center;gap:8px;margin-bottom:40px;">
        <div style="width:180px;height:100px;background:linear-gradient(135deg,#1e3c72 0%,#2a5298 50%,#ff6b6b 100%);border-radius:20px;display:flex;flex-direction:column;align-items:center;justify-content:center;box-shadow:0 8px 25px rgba(30,60,114,0.4);padding:16px;position:relative;overflow:hidden;">
          <!-- Geometric Background Pattern -->
          <div style="position:absolute;top:-10px;right:-10px;width:40px;height:40px;background:rgba(255,255,255,0.1);border-radius:50%;transform:rotate(45deg);"></div>
          <div style="position:absolute;bottom:-15px;left:-15px;width:30px;height:30px;background:rgba(255,255,255,0.08);border-radius:50%;transform:rotate(-30deg);"></div>
          
          <!-- Main Logo Icon -->
          <div style="width:50px;height:50px;background:rgba(255,255,255,0.95);border-radius:12px;display:flex;align-items:center;justify-content:center;margin-bottom:8px;box-shadow:0 4px 15px rgba(0,0,0,0.2);">
            <div style="width:30px;height:30px;background:linear-gradient(45deg,#ff6b6b,#4ecdc4);border-radius:8px;display:flex;align-items:center;justify-content:center;position:relative;">
              <div style="width:20px;height:20px;background:#fff;border-radius:4px;display:flex;align-items:center;justify-content:center;">
                <div style="width:12px;height:12px;background:linear-gradient(45deg,#ff6b6b,#4ecdc4);border-radius:2px;position:relative;">
                  <div style="position:absolute;top:2px;left:2px;width:4px;height:4px;background:#fff;border-radius:1px;"></div>
                  <div style="position:absolute;bottom:2px;right:2px;width:4px;height:4px;background:#fff;border-radius:1px;"></div>
                </div>
              </div>
            </div>
          </div>
          
          <!-- Brand Text -->
          <div style="font-size:1.4rem;font-weight:800;color:#fff;text-align:center;line-height:1.1;letter-spacing:2px;text-shadow:0 2px 4px rgba(0,0,0,0.3);">
            <span style="color:#FFD700;text-shadow:0 0 10px rgba(255,215,0,0.5);">CS</span>
          </div>
          <div style="font-size:0.6rem;color:rgba(255,255,255,0.9);font-weight:500;margin-top:2px;letter-spacing:1px;">
            ClassSahyogi
          </div>
        </div>
      </div>
      <a href="index.html"><span>üè†</span> Dashboard</a>
      <a href="enrollment.html"><span>üìù</span> Enrollment</a>
      <a href="fees.html"><span>üí∞</span> Fees</a>
      <a href="timetable.html"><span>üìÖ</span> Timetable</a>
      <a href="staff.html"><span>üë•</span> Staff</a>
      <a href="analytics.html"><span>üìä</span> Analytics</a>
      <a href="attendance.html"><span>üßæ</span> Attendance</a>
      <a href="marks.html"><span>üéì</span> Marks</a>
    </nav>
    <div style="flex:1;display:flex;flex-direction:column;min-height:100vh;">
      <header>
        <div style="width:140px;height:45px;background:linear-gradient(135deg,#1e3c72 0%,#2a5298 50%,#ff6b6b 100%);border-radius:12px;display:flex;align-items:center;justify-content:center;margin-right:12px;padding:8px;position:relative;overflow:hidden;box-shadow:0 4px 15px rgba(30,60,114,0.3);">
          <!-- Mini Geometric Pattern -->
          <div style="position:absolute;top:-5px;right:-5px;width:20px;height:20px;background:rgba(255,255,255,0.1);border-radius:50%;transform:rotate(45deg);"></div>
          
          <!-- Mini Logo Icon -->
          <div style="width:25px;height:25px;background:rgba(255,255,255,0.95);border-radius:6px;display:flex;align-items:center;justify-content:center;margin-right:8px;box-shadow:0 2px 8px rgba(0,0,0,0.2);">
            <div style="width:15px;height:15px;background:linear-gradient(45deg,#ff6b6b,#4ecdc4);border-radius:4px;position:relative;">
              <div style="position:absolute;top:1px;left:1px;width:2px;height:2px;background:#fff;border-radius:1px;"></div>
              <div style="position:absolute;bottom:1px;right:1px;width:2px;height:2px;background:#fff;border-radius:1px;"></div>
            </div>
          </div>
          
          <!-- Brand Text -->
          <div style="font-size:0.9rem;font-weight:800;color:#fff;letter-spacing:1px;text-shadow:0 1px 3px rgba(0,0,0,0.3);">
            <span style="color:#FFD700;text-shadow:0 0 8px rgba(255,215,0,0.4);">CS</span>
          </div>
        </div>
        <span>üìÖ ClassSahyogi - Timetable Management</span>
      </header>
      <div class="card">
        <a href="javascript:void(0)" onclick="goToDashboard()" style="display:inline-block; margin-bottom:12px; background:#e5e7eb; color:#111827; padding:8px 14px; border-radius:8px; text-decoration:none;">‚Üê Back to Dashboard</a>
        
        <!-- Add/Edit Period -->
        <div class="form-section">
          <h4 style="margin-top: 0; color: #333;">üìö Add/Edit Period</h4>
          <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 12px;">
            <select id="classSelect">
              <option value="">Select Class</option>
            </select>
            <select id="daySelect">
              <option value="">Select Day</option>
              <option value="Monday">Monday</option>
              <option value="Tuesday">Tuesday</option>
              <option value="Wednesday">Wednesday</option>
              <option value="Thursday">Thursday</option>
              <option value="Friday">Friday</option>
              <option value="Saturday">Saturday</option>
            </select>
            <select id="periodSelect">
              <option value="">Select Period</option>
              <option value="1">Period 1 (9:00-10:00)</option>
              <option value="2">Period 2 (10:00-11:00)</option>
              <option value="3">Period 3 (11:00-12:00)</option>
              <option value="4">Period 4 (12:00-1:00)</option>
              <option value="5">Period 5 (2:00-3:00)</option>
              <option value="6">Period 6 (3:00-4:00)</option>
              <option value="7">Period 7 (4:00-5:00)</option>
            </select>
            <input type="text" id="subject" placeholder="Subject">
            <input type="text" id="teacher" placeholder="Teacher Name">
            <input type="text" id="room" placeholder="Room No.">
            <button onclick="addPeriod()" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);">Add Period</button>
          </div>
        </div>

        <!-- Timetable Display -->
        <div style="background: linear-gradient(135deg, #ffecd2 0%, #fcb69f 100%); padding: 20px; border-radius: 12px; margin-bottom: 20px;">
          <h4 style="margin-top: 0; color: #333;">üìã Timetable</h4>
          <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 12px; margin-bottom: 16px;">
            <select id="viewClass">
              <option value="">Select Class to View</option>
            </select>
            <button onclick="loadTimetable()" style="background: linear-gradient(135deg, #ff9a9e 0%, #fecfef 100%);">Load Timetable</button>
            <button onclick="exportTimetable()" style="background: linear-gradient(135deg, #a8edea 0%, #fed6e3 100%);">Export PDF</button>
          </div>
          <div id="timetableContainer"></div>
        </div>
      </div>
    </div>
  </div>

  <script>
    function goToDashboard() {
      const currentUser = JSON.parse(sessionStorage.getItem('currentUser') || '{}');
      
      if (currentUser.role === 'admin') {
        window.location.href = 'admin-dashboard.html';
      } else if (currentUser.role === 'teacher') {
        window.location.href = 'teacher-dashboard.html';
      } else if (currentUser.role === 'student') {
        window.location.href = 'student-dashboard.html';
      } else {
        // No user logged in, go to main page
        window.location.href = 'index.html';
      }
    }

    let timetableData = JSON.parse(localStorage.getItem('timetableData')) || [];
    let students = JSON.parse(localStorage.getItem('students')) || [];

    function loadClasses() {
      const classSelect = document.getElementById('classSelect');
      const viewClass = document.getElementById('viewClass');
      const classes = [...new Set(students.map(s => s.class))];
      
      const options = '<option value="">Select Class</option>' + 
        classes.map(c => `<option value="${c}">${c}</option>`).join('');
      
      classSelect.innerHTML = options;
      viewClass.innerHTML = options;
    }

    function addPeriod() {
      const classVal = document.getElementById('classSelect').value;
      const day = document.getElementById('daySelect').value;
      const period = document.getElementById('periodSelect').value;
      const subject = document.getElementById('subject').value;
      const teacher = document.getElementById('teacher').value;
      const room = document.getElementById('room').value;

      if (!classVal || !day || !period || !subject) {
        alert('Please fill all required fields');
        return;
      }

      const periodData = {
        id: Date.now(),
        class: classVal,
        day,
        period: parseInt(period),
        subject,
        teacher,
        room,
        timestamp: new Date().toISOString()
      };

      // Remove existing period for same class/day/period
      timetableData = timetableData.filter(t => 
        !(t.class === classVal && t.day === day && t.period === parseInt(period))
      );
      
      timetableData.push(periodData);
      localStorage.setItem('timetableData', JSON.stringify(timetableData));
      
      alert('Period added successfully!');
      document.getElementById('classSelect').value = '';
      document.getElementById('daySelect').value = '';
      document.getElementById('periodSelect').value = '';
      document.getElementById('subject').value = '';
      document.getElementById('teacher').value = '';
      document.getElementById('room').value = '';
    }

    function loadTimetable() {
      const selectedClass = document.getElementById('viewClass').value;
      if (!selectedClass) {
        alert('Please select a class');
        return;
      }

      const classTimetable = timetableData.filter(t => t.class === selectedClass);
      const container = document.getElementById('timetableContainer');
      
      const days = ['Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday'];
      const periods = [1, 2, 3, 4, 5, 6, 7];
      const timeSlots = ['9:00-10:00', '10:00-11:00', '11:00-12:00', '12:00-1:00', '2:00-3:00', '3:00-4:00', '4:00-5:00'];

      let html = '<div class="timetable">';
      
      // Header row
      html += '<div class="time-slot day-header">Time</div>';
      days.forEach(day => {
        html += `<div class="time-slot day-header">${day}</div>`;
      });
      
      // Period rows
      periods.forEach((period, index) => {
        html += `<div class="time-slot">${timeSlots[index]}</div>`;
        days.forEach(day => {
          const periodData = classTimetable.find(t => t.day === day && t.period === period);
          if (periodData) {
            html += `<div class="subject-cell" onclick="editPeriod(${periodData.id})">
              <div style="font-weight: bold;">${periodData.subject}</div>
              <div style="font-size: 0.8rem; color: #666;">${periodData.teacher}</div>
              <div style="font-size: 0.8rem; color: #666;">Room: ${periodData.room}</div>
            </div>`;
          } else {
            html += `<div class="subject-cell editable" onclick="addPeriodToSlot('${day}', ${period})">
              <div style="color: #999;">Click to add</div>
            </div>`;
          }
        });
      });
      
      html += '</div>';
      container.innerHTML = html;
    }

    function addPeriodToSlot(day, period) {
      const selectedClass = document.getElementById('viewClass').value;
      if (!selectedClass) {
        alert('Please select a class first');
        return;
      }
      
      document.getElementById('classSelect').value = selectedClass;
      document.getElementById('daySelect').value = day;
      document.getElementById('periodSelect').value = period;
      
      // Scroll to form
      document.querySelector('.form-section').scrollIntoView({ behavior: 'smooth' });
    }

    function editPeriod(periodId) {
      const period = timetableData.find(p => p.id === periodId);
      if (!period) return;
      
      document.getElementById('classSelect').value = period.class;
      document.getElementById('daySelect').value = period.day;
      document.getElementById('periodSelect').value = period.period;
      document.getElementById('subject').value = period.subject;
      document.getElementById('teacher').value = period.teacher;
      document.getElementById('room').value = period.room;
      
      // Scroll to form
      document.querySelector('.form-section').scrollIntoView({ behavior: 'smooth' });
    }

    function exportTimetable() {
      const selectedClass = document.getElementById('viewClass').value;
      if (!selectedClass) {
        alert('Please select a class first');
        return;
      }

      const classTimetable = timetableData.filter(t => t.class === selectedClass);
      const days = ['Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday'];
      const periods = [1, 2, 3, 4, 5, 6, 7];
      const timeSlots = ['9:00-10:00', '10:00-11:00', '11:00-12:00', '12:00-1:00', '2:00-3:00', '3:00-4:00', '4:00-5:00'];

      let csv = ['Time,' + days.join(',')];
      
      periods.forEach((period, index) => {
        let row = [timeSlots[index]];
        days.forEach(day => {
          const periodData = classTimetable.find(t => t.day === day && t.period === period);
          if (periodData) {
            row.push(`${periodData.subject} (${periodData.teacher})`);
          } else {
            row.push('');
          }
        });
        csv.push(row.join(','));
      });

      const blob = new Blob([csv.join('\n')], { type: 'text/csv' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = `timetable_${selectedClass}_${new Date().toISOString().split('T')[0]}.csv`;
      a.click();
    }

    // Initialize
    loadClasses();
  </script>
</body>
</html>
