<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Marks • ClassSahyogi</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter&display=swap" rel="stylesheet">
  <style>
    html { scroll-behavior: smooth; }
    * { box-sizing: border-box; font-family: 'Inter', sans-serif; }
    body { margin: 0; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); min-height: 100vh; overflow-x: hidden; }
    .layout { display: flex; min-height: 100vh; }
    nav { width: 220px; background: #232946; color: #fff; display: flex; flex-direction: column; align-items: center; padding: 32px 0; }
    nav a { color: #fff; text-decoration: none; margin: 18px 0; display: flex; align-items: center; gap: 10px; font-size: 1.1rem; }
    header { height: 64px; background: rgba(255,255,255,0.95); box-shadow: 0 2px 12px rgba(35,41,70,0.06); display: flex; align-items: center; padding: 0 36px; color: #232946; font-weight: 500; gap: 12px; }
    .card { background: rgba(255,255,255,0.98); border-radius: 18px; box-shadow: 0 8px 32px rgba(35,41,70,0.10); margin: 32px 48px; padding: 36px 48px; min-height: 80vh; flex: 1; }
    table { width:100%; border-collapse:collapse; }
    th, td { padding:10px; text-align:left; border-bottom:1px solid #ddd; }
    th { background:#f2f2f2; }
    button { background: #007bff; color: #fff; border: none; border-radius: 8px; padding: 10px 16px; cursor: pointer; }
    select { padding: 6px 12px; border-radius: 6px; border: 1px solid #bbb; }
    input[type=number] { width:70px; }
  </style>
</head>
<body>
  <div class="layout">
    <nav>
      <div style="display:flex;flex-direction:column;align-items:center;gap:8px;margin-bottom:40px;">
        <div style="width:180px;height:100px;background:linear-gradient(135deg,#1e3c72 0%,#2a5298 50%,#ff6b6b 100%);border-radius:20px;display:flex;flex-direction:column;align-items:center;justify-content:center;box-shadow:0 8px 25px rgba(30,60,114,0.4);padding:16px;position:relative;overflow:hidden;">
          <!-- Geometric Background Pattern -->
          <div style="position:absolute;top:-10px;right:-10px;width:40px;height:40px;background:rgba(255,255,255,0.1);border-radius:50%;transform:rotate(45deg);"></div>
          <div style="position:absolute;bottom:-15px;left:-15px;width:30px;height:30px;background:rgba(255,255,255,0.08);border-radius:50%;transform:rotate(-30deg);"></div>
          
          <!-- Main Logo Icon -->
          <div style="width:50px;height:50px;background:rgba(255,255,255,0.95);border-radius:12px;display:flex;align-items:center;justify-content:center;margin-bottom:8px;box-shadow:0 4px 15px rgba(0,0,0,0.2);">
            <div style="width:30px;height:30px;background:linear-gradient(45deg,#ff6b6b,#4ecdc4);border-radius:8px;display:flex;align-items:center;justify-content:center;position:relative;">
              <div style="width:20px;height:20px;background:#fff;border-radius:4px;display:flex;align-items:center;justify-content:center;">
                <div style="width:12px;height:12px;background:linear-gradient(45deg,#ff6b6b,#4ecdc4);border-radius:2px;position:relative;">
                  <div style="position:absolute;top:2px;left:2px;width:4px;height:4px;background:#fff;border-radius:1px;"></div>
                  <div style="position:absolute;bottom:2px;right:2px;width:4px;height:4px;background:#fff;border-radius:1px;"></div>
                </div>
              </div>
            </div>
          </div>
          
          <!-- Brand Text -->
          <div style="font-size:1.4rem;font-weight:800;color:#fff;text-align:center;line-height:1.1;letter-spacing:2px;text-shadow:0 2px 4px rgba(0,0,0,0.3);">
            <span style="color:#FFD700;text-shadow:0 0 10px rgba(255,215,0,0.5);">CS</span>
          </div>
          <div style="font-size:0.6rem;color:rgba(255,255,255,0.9);font-weight:500;margin-top:2px;letter-spacing:1px;">
            ClassSahyogi
          </div>
        </div>
      </div>
      <a href="index.html"><span>🏠</span> Dashboard</a>
      <a href="enrollment.html"><span>📝</span> Enrollment</a>
      <a href="fees.html"><span>💰</span> Fees</a>
      <a href="timetable.html"><span>📅</span> Timetable</a>
      <a href="staff.html"><span>👥</span> Staff</a>
      <a href="analytics.html"><span>📊</span> Analytics</a>
      <a href="attendance.html"><span>🧾</span> Attendance</a>
      <a href="marks.html"><span>🎓</span> Marks</a>
    </nav>
    <div style="flex:1;display:flex;flex-direction:column;min-height:100vh;">
      <header>
        <div style="width:140px;height:45px;background:linear-gradient(135deg,#1e3c72 0%,#2a5298 50%,#ff6b6b 100%);border-radius:12px;display:flex;align-items:center;justify-content:center;margin-right:12px;padding:8px;position:relative;overflow:hidden;box-shadow:0 4px 15px rgba(30,60,114,0.3);">
          <!-- Mini Geometric Pattern -->
          <div style="position:absolute;top:-5px;right:-5px;width:20px;height:20px;background:rgba(255,255,255,0.1);border-radius:50%;transform:rotate(45deg);"></div>
          
          <!-- Mini Logo Icon -->
          <div style="width:25px;height:25px;background:rgba(255,255,255,0.95);border-radius:6px;display:flex;align-items:center;justify-content:center;margin-right:8px;box-shadow:0 2px 8px rgba(0,0,0,0.2);">
            <div style="width:15px;height:15px;background:linear-gradient(45deg,#ff6b6b,#4ecdc4);border-radius:4px;position:relative;">
              <div style="position:absolute;top:1px;left:1px;width:2px;height:2px;background:#fff;border-radius:1px;"></div>
              <div style="position:absolute;bottom:1px;right:1px;width:2px;height:2px;background:#fff;border-radius:1px;"></div>
            </div>
          </div>
          
          <!-- Brand Text -->
          <div style="font-size:0.9rem;font-weight:800;color:#fff;letter-spacing:1px;text-shadow:0 1px 3px rgba(0,0,0,0.3);">
            <span style="color:#FFD700;text-shadow:0 0 8px rgba(255,215,0,0.4);">CS</span>
          </div>
        </div>
        <span>🎓 ClassSahyogi - Marks + Grading</span>
      </header>
      <div class="card">
        <a href="javascript:void(0)" onclick="goToDashboard()" style="display:inline-block; margin-bottom:12px; background:#e5e7eb; color:#111827; padding:8px 14px; border-radius:8px; text-decoration:none;">← Back to Dashboard</a>
        <h4 style="margin-top: 0; color: #333; font-size: 1.5rem;">🎓 Marks + Grading System</h4>
        <label for="marksDivisionSelect"><strong>Select Division:</strong></label>
        <select id="marksDivisionSelect" style="margin: 0 0 16px 12px;"></select>
        <form id="marksForm">
          <table id="marksTable">
            <thead>
              <tr>
                <th>Name</th>
                <th>Roll No</th>
                <th>Class</th>
                <th>English</th>
                <th>Math</th>
                <th>Science</th>
                <th>Social</th>
                <th>Computer</th>
                <th>Total</th>
                <th>Average</th>
                <th>Grade</th>
              </tr>
            </thead>
            <tbody></tbody>
          </table>
          <button type="submit" style="margin-top:18px; width:auto; padding:8px 24px;">Save Marks</button>
        </form>
      </div>
    </div>
  </div>

  <script>
    // Check user role and restrict access
    window.addEventListener('load', function() {
      const currentUser = JSON.parse(sessionStorage.getItem('currentUser') || '{}');
      
      if (currentUser.role === 'teacher') {
        // Hide staff link for teachers
        const staffLink = document.querySelector('a[href="staff.html"]');
        if (staffLink) {
          staffLink.style.display = 'none';
        }
      }
    });

    function goToDashboard() {
      const currentUser = JSON.parse(sessionStorage.getItem('currentUser') || '{}');
      
      if (currentUser.role === 'admin') {
        window.location.href = 'admin-dashboard.html';
      } else if (currentUser.role === 'teacher') {
        window.location.href = 'teacher-dashboard.html';
      } else if (currentUser.role === 'student') {
        window.location.href = 'student-dashboard.html';
      } else {
        // No user logged in, go to main page
        window.location.href = 'index.html';
      }
    }

    function populateMarksDivisionDropdown() {
      const students = JSON.parse(localStorage.getItem("students")) || [];
      const select = document.getElementById("marksDivisionSelect");
      const divisions = Array.from(new Set(students.map(s => s.class))).filter(Boolean);
      select.innerHTML = divisions.length ? divisions.map(d => `<option value="${d}">${d}</option>`).join("") : '<option value="">No divisions</option>';
    }
    function populateMarksTable() {
      const students = JSON.parse(localStorage.getItem("students")) || [];
      const marks = JSON.parse(localStorage.getItem("marks")) || {};
      const division = document.getElementById('marksDivisionSelect').value;
      const tbody = document.querySelector('#marksTable tbody');
      const filtered = students.filter(s => s.class === division);
      tbody.innerHTML = '';
      filtered.forEach((s, i) => {
        const studentMarks = marks[s.roll] || {};
        const english = Number(studentMarks.english) || 0;
        const math = Number(studentMarks.math) || 0;
        const science = Number(studentMarks.science) || 0;
        const social = Number(studentMarks.social) || 0;
        const computer = Number(studentMarks.computer) || 0;
        const total = english + math + science + social + computer;
        const avg = filtered.length ? (total / 5).toFixed(2) : '0.00';
        let grade = '';
        if (avg >= 90) grade = 'A';
        else if (avg >= 80) grade = 'B';
        else if (avg >= 70) grade = 'C';
        else if (avg >= 60) grade = 'D';
        else grade = 'Fail';
        tbody.innerHTML += `<tr>
          <td>${s.name}</td>
          <td>${s.roll}</td>
          <td>${s.class}</td>
          <td><input type='number' name='english_${s.roll}' value='${studentMarks.english ?? ''}' min='0' max='100'></td>
          <td><input type='number' name='math_${s.roll}' value='${studentMarks.math ?? ''}' min='0' max='100'></td>
          <td><input type='number' name='science_${s.roll}' value='${studentMarks.science ?? ''}' min='0' max='100'></td>
          <td><input type='number' name='social_${s.roll}' value='${studentMarks.social ?? ''}' min='0' max='100'></td>
          <td><input type='number' name='computer_${s.roll}' value='${studentMarks.computer ?? ''}' min='0' max='100'></td>
          <td class='totalCell'>${total}</td>
          <td class='avgCell'>${avg}</td>
          <td class='gradeCell'>${grade}</td>
        </tr>`;
      });
      tbody.querySelectorAll('input[type=number]').forEach(input => {
        input.addEventListener('input', function() {
          const row = input.closest('tr');
          const inputs = row.querySelectorAll('input[type=number]');
          let t = 0;
          inputs.forEach(inp => t += Number(inp.value) || 0);
          const avg = (t / 5).toFixed(2);
          let grade = '';
          if (avg >= 90) grade = 'A';
          else if (avg >= 80) grade = 'B';
          else if (avg >= 70) grade = 'C';
          else if (avg >= 60) grade = 'D';
          else grade = 'Fail';
          row.querySelector('.totalCell').innerText = t;
          row.querySelector('.avgCell').innerText = avg;
          row.querySelector('.gradeCell').innerText = grade;
        });
      });
    }
    document.getElementById('marksDivisionSelect').addEventListener('change', populateMarksTable);
    document.getElementById('marksForm').onsubmit = function(e) {
      e.preventDefault();
      const students = JSON.parse(localStorage.getItem("students")) || [];
      const division = document.getElementById('marksDivisionSelect').value;
      let marks = JSON.parse(localStorage.getItem("marks")) || {};
      const filtered = students.filter(s => s.class === division);
      filtered.forEach(s => {
        marks[s.roll] = {
          english: document.querySelector(`[name='english_${s.roll}']`).value || '',
          math: document.querySelector(`[name='math_${s.roll}']`).value || '',
          science: document.querySelector(`[name='science_${s.roll}']`).value || '',
          social: document.querySelector(`[name='social_${s.roll}']`).value || '',
          computer: document.querySelector(`[name='computer_${s.roll}']`).value || ''
        };
      });
      localStorage.setItem("marks", JSON.stringify(marks));
      alert("Marks saved for division " + division + "!");
    };
    populateMarksDivisionDropdown();
    populateMarksTable();
  </script>
</body>
</html>


